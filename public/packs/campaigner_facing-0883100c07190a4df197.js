!function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/packs/",t(t.s=668)}({147:function(e,t,i){"use strict";t.a={show:function(e,t){if(e&&t&&t.responseText&&t.getResponseHeader("Content-Type").match(/json/i)&&422==t.status){var i=$(e.target)&&$(e.target).length?$(e.target):$("form"),a=$.parseJSON(t.responseText);ErrorDisplay.clearErrors(i),$.each(a.errors,function(e,t){ErrorDisplay.showError(e,t,i,a)})}},clearErrors:function(e){e.find(".has-error").removeClass("has-error"),e.find(".error-msg").remove()},showError:function(e,t,i,a){var n=ErrorDisplay.findField(e,i,a);n.addClass("has-error").parent().addClass("has-error"),n.parent().append(ErrorDisplay.errorMsg(e,t)),n.on("change",function(e){ErrorDisplay.hideError(e)})},errorMsg:function(e,t){var i="string"==typeof t?t:t[0];return"<div class='error-msg'>"+(window.I18n?I18n.t("errors.this_field"):"The field")+" "+i+"</div>"},hideError:function(e){$(e.target).removeClass("has-error").parent().removeClass("has-error"),$(e.target).siblings(".error-msg").remove(),$(e.target).parent(".error-msg").remove()},findField:function(e,t,i){i.name&&(e=[i.name,"[",e,"]"].join(""));var a=t.find('[name="'+e+'"]');if(a.length){if("radio"===a.attr("type")&&a.parents(".radio-container").length)return a.parents(".radio-container")}else a=t.find(":submit").prev();return a}}},149:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(26),r=i.n(s),o=i(94),l=i.n(o);t.a={bindEvents:function(e){var t=e.globalEvents;if(t&&r.a.isObject(t))for(var i in t){var a=t[i],s=e[a];s&&(l.a.on(i,s,e),n.a.subscribe(i,s.bind(e)))}}}},24:function(e,t){e.exports=window.$},26:function(e,t){e.exports=window._},327:function(e,t,i){"use strict";function a(e,t){$(e).each(function(e,i){var a=$(i);if(1!=a.data("js-inited")){new t({el:a});a.data("js-inited",!0)}})}t.a=a},380:function(e,t,i){"use strict";var a=i(24),n=i.n(a);!function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}}(n.a)},587:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(327),r=Backbone.View.extend({events:{"click .action-publisher .btn":"handleClick","ajax:success form.shares-editor__new-form":"clearFormAndConformView"},initialize:function(){this.pageId=this.$el.data("page-id")},updateButtons:function(e,t){e.find(".btn-primary").removeClass("btn-primary"),e.find('[data-state="'+t+'"]').addClass("btn-primary")},handleClick:function(e){var t=n()(e.target),i=t.parents(".action-publisher"),a=i.find(".btn-primary").data("state"),s=t.data("state");this.updateAction(i,s,a)},updateAction:function(e,t,i){var a=this;this.updateButtons(e,t),n.a.ajax("/api/pages/"+this.pageId+"/actions/"+e.data("id"),{method:"PUT",data:{publish_status:t}}).fail(function(){a.updateButtons(e,i)})}});n.a.subscribe("actions:edit",function(){i.i(s.a)(".actions-editor",r)})},588:function(e,t,i){"use strict";var a=i(147);$(function(){var e=function(e,t){var i=$(e.target).find(".xhr-feedback");$(e.target).find(".xhr-feedback-saving").remove(),i.prop("disabled",!0);var a=$("<span />").addClass("label label-success xhr-feedback-saving").text("Saving...");i.after(a)},t=function(e){$(e.target).find(".xhr-feedback").prop("disabled",!1)},i=function(e,i){t(e);$(".xhr-feedback-saving").removeClass("label-success").addClass("label-danger").text("Save failed.");a.a.show(e,i)},n=function(e){t(e);var i=$(".xhr-feedback-saving").text("Saved!");window.setTimeout(function(){i.fadeOut()},1e3)};$("body").on("ajax:beforeSend",e),$("body").on("ajax:success",n),$("body").on("ajax:error",i)})},589:function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=function(){function e(){a(this,e),this.barPadding=1,this.bottomMargin=100,this.margins={bottom:30},this.xAxis=!0,this.labels=!0}return n(e,null,[{key:"yAxisLabelLimit",get:function(){return 20}}]),n(e,[{key:"render",value:function(){this.svg.attr("width",this.width).attr("height",this.height+this.margins.bottom),this.setYScale(this.data),this.draw(),this.labels&&this.drawLabels(),this.xAxis&&this.drawAxis()}},{key:"update",value:function(){var e=this;this.setYScale(this.data),this.svg.selectAll(".bar").data(this.data).transition().duration(750).attr("height",function(t){return e.scale(t.value)}).attr("y",function(t){return e.height-e.scale(t.value)}),this.drawLabels(),this.svg.selectAll(".label").data(this.data).transition().duration(1e3).text(function(e){return e.value}).attr("y",this.setYForLabel.bind(this)).attr("fill",this.setFillForLabel.bind(this))}},{key:"setYForLabel",value:function(t){var i=this.scale(t.value),a=this.height-i+15;return i<e.yAxisLabelLimit&&(a-=e.yAxisLabelLimit),a}},{key:"setFillForLabel",value:function(e){return this.scale(e.value)<20?"#333":"#fff"}},{key:"draw",value:function(){var e=this;this.svg.selectAll(".bar").data(this.data).enter().append("rect").attr("width",this.width/this.data.length-this.barPadding).attr("fill",this.fill).attr("class","bar").attr("height",function(t){return e.scale(t.value)}).attr("y",function(t){return e.height-e.scale(t.value)}).attr("x",function(t,i){return i*(e.width/e.data.length)})}},{key:"drawLabels",value:function(){var e=this;this.svg.selectAll("text").data(this.data).enter().append("text").text(function(e){return e.value}).attr("x",function(t,i){return i*(e.width/e.data.length)+(e.width/e.data.length-e.barPadding)/2}).attr("y",this.setYForLabel.bind(this)).attr("class","label").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","11px").attr("fill",this.setFillForLabel.bind(this))}},{key:"drawAxis",value:function(){var e=this,t=d3.scale.ordinal().domain(this.data.map(function(t,i){return moment(t.date).format(e.axisDateFormat)})).rangeBands([0,this.width]),i=d3.svg.axis().scale(t).orient("bottom");this.svg.append("g").attr("class","x axis").attr("transform","translate(0, "+this.height+")").call(i)}},{key:"setYScale",value:function(e){this.scale=d3.scale.linear().domain([0,d3.max(e,function(e){return e.value})]).range([0,this.height])}}]),e}(),r=function(){function e(t,i){a(this,e),this.id=t,this.chart=i,this.$totalAll=$(".total-actions-all"),this.$totalNew=$(".total-actions-new"),$("button#refresh-data").on("click",this.refreshData.bind(this))}return n(e,[{key:"getData",value:function(e){var t=this;d3.json("/api/pages/"+this.id+"/analytics.json",function(i){e&&(e(i),t.setCounters(i.totals))})}},{key:"setCounters",value:function(e){this.$totalAll.html(e.all_total),this.$totalNew.html(e.new_total)}},{key:"refreshData",value:function(){var e=this;this.getData(function(t){e.chart.data=t.hours,e.chart.update()})}}]),e}(),o=function(e,t){var i=d3.select("#analytics-dashboard ."+e+" .chart"),a=new s;return a.width=360,a.height=70,a.fill="rgba(51,51,51,0.3)",a.data=t,a.xAxis=!1,a.labels=!1,a.svg=i,a};t.a={makeDashboard:function(e){var t=d3.select("#analytics-dashboard .short-view .chart"),i=new s;new r(e,i).getData(function(e){i.width=495,i.height=280,i.data=e.hours,i.fill="rgba(51,51,51,1)",i.svg=t,i.axisDateFormat="HH a",i.render(),o("mini-total",e.days_total.reverse()).render(),o("mini-new",e.days_new.reverse()).render()})}}},590:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(327),r=i(147),o=i(149),l=Backbone.View.extend({whitelist:["address1","address2","city","country","email","first_name","last_name","middle_name","mobile_phone","name","phone","plus4","postal","prefix","region","state","suffix","zip","customer","employee","shareholder","investor"],events:{"ajax:success #new_collection_element":"newElementAdded","ajax:success #change-form-template":"templateChanged","ajax:error a[data-method=delete]":"deleteFailed","sortupdate .list-group":"updateSort"},globalEvents:{"survey:form_added":"autoComplete"},initialize:function(){this.makeSortable(),this.autoComplete(),this.$el.on("ajax:success","a[data-method=delete]",function(){n()(this).parents(".list-group-item").fadeOut()}),o.a.bindEvents(this)},deleteFailed:function(e,t){var i=this.deleteErrorMessage(t);alert(i)},deleteErrorMessage:function(e){var t=e&&e.responseJSON&&e.responseJSON.errors;return!t||Object.keys(t).length<1?"That element could not be deleted":"That element "+t[Object.keys(t)[0]]},substringMatcher:function(e){return function(t,i){var a=[],s=new RegExp(t,"i");n.a.each(e,function(e,t){s.test(t)&&a.push(t)}),i(a)}},autoComplete:function(){var e=this.$(".typeahead.typeahead--uninitialized");e.removeClass("typeahead--uninitialized"),e.typeahead({hint:!0,highlight:!0,minLength:1},{name:"fields",source:this.substringMatcher(this.whitelist)})},makeSortable:function(){this.$(".list-group.sortable").sortable()},updateSort:function(e,t,i,a){var s=t.item.parent().children().map(function(e,t){return n()(t).data("id")}).get().join(),r=t.item.parent().parent().find("form#sort-collection-elements");r.find("#form_element_ids").val(s),r.submit()},newElementAdded:function(e,t,i){var a=this.$(e.target).parents(".form-customization").find(".list-group");a=a.length?a:this.$(".list-group"),a.append(t),this.$("#form_element_label, #form_element_name").val(""),r.a.clearErrors(this.$("form#new_collection_element")),Backbone.trigger("collection:element_added"),this.makeSortable()},templateChanged:function(e,t){this.$(".forms-edit").html(t.html),this.makeSortable(),this.$("#sort-collection-elements, #new_collection_element").each(function(e,i){var a=n()(i).attr("action").replace(/\d+/,t.form_id);n()(i).attr("action",a)})}});n.a.subscribe("collection:edit:loaded",function(){i.i(s.a)(".collection-editor",l)})},591:function(e,t,i){"use strict";function a(e,t){var i=s()("#"+t);if(0===i.length)return!1;i.summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["fontname","fontsize"]],["para",["ul","ol","paragraph"]],["color",["color"]],["insert",["link","picture","video"]],["view",["fullscreen","codeview","help"]]],height:r.indexOf(t)>-1?280:120,fontSizes:["8","10","11","12","14","16","20","24","36","72"],codemirror:{theme:"default",mode:"text/html",lineNumbers:!0,tabMode:"indent",lineWrapping:!0}});var a=s()("#"+t+"_content");i.summernote("fontSize","16"),i.summernote("code",a.val());var n=function(e){if(-1===e.indexOf("iframe"))return e;var t=s()(e);return t.find("iframe").parent().addClass("iframe-responsive-container"),s()("<div></div>").append(t).html()},o=function(){var e=n(i.summernote("code"));a.val(e)};s.a.subscribe("wysiwyg:submit",o)}var n=i(24),s=i.n(n),r=["page_body"];s.a.subscribe("wysiwyg:setup",a)},592:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=function(){Dropzone.options.dropzone={maxFilesize:2,paramName:"image[content]",addRemoveLinks:!1,previewsContainer:null,createImageThumbnails:!0,previewTemplate:document.querySelector("#dropzone-preview-template").innerHTML,init:function(){this.on("success",function(e,t){n()(".campaign-images .notice").hide(),n()(".dz-success").replaceWith(t);var i=n()(t).data("image-id");n.a.publish("image:success",[e,i,t])}),this.on("addedfiled",function(e){this.removeFile(e)})}}},r=function(){n()(".campaign-images").on("ajax:success","a[data-method=delete]",function(){n()(this).parents(".dz-preview").fadeOut();var e=n()(this).parents("[data-image-id]").data("image-id");n.a.publish("image:destroyed",e)})},o=function(){console.log("hi"),s(),r()},l=function(e,t,i,a){var s="<option value='"+i+"'>"+t.name+"</option>";n()("#page_primary_image_id").append(s)},c=function(e,t){n()("#page_primary_image_id").find('option[value="'+t+'"]').remove()};n.a.subscribe("dropzone:setup",o),n.a.subscribe("image:success",l),n.a.subscribe("image:destroyed",c)},593:function(e,t,i){"use strict";var a=i(149),n=Backbone.View.extend({GENERIC_NAME:"instruction",GENERIC_LABEL:"hidden",roles:["defaultValue","defaultRevealer","choices","label","name","manyChoices"],modes:{default:["defaultRevealer","label","name","requirable"],hidden:["defaultValue","name"],instruction:["label"],choice:["choices","label","name","requirable"],dropdown:["manyChoices","label","name","requirable","defaultRevealer"]},events:{"change #form_element_data_type":"changeFormMode","click .form-element__remove-choice":"removeChoice","click .form-element__add-choice":"addChoice"},globalEvents:{"collection:element_added":"resetAfterSubmission"},initialize:function(){this.changeFormMode({target:this.$("#form_element_data_type")}),a.a.bindEvents(this)},changeFormMode:function(e){var t=this.$(e.target).val();this.modes.hasOwnProperty(t)||(t="default"),this.mode=t,this.setModeVisuals(t),this.setModeValues(t)},resetAfterSubmission:function(){this.setModeVisuals(this.mode),this.setModeValues(this.mode)},setModeVisuals:function(e){var t=!0,i=!1,a=void 0;try{for(var n,s=this.roles[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var r=n.value;this.$("[data-editor-role="+r+"]").toggleClass("hidden-closed",!this.hasField(r,e))}}catch(e){i=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw a}}},setModeValues:function(e){this.hasField("choices",e)||this.resetChoices(),this.hasField("defaultValue",e)||this.resetDefaultValue(),this.hasField("requirable",e)||this.resetRequired(),this.hasField("name",e)?this.setNameAwayFromGeneric():this.setNameToGeneric(),this.hasField("label",e)?this.setLabelAwayFromGeneric():this.setLabelToGeneric()},hasField:function(e,t){return this.modes[t].indexOf(e)>-1},setNameToGeneric:function(){this.$("input#form_element_name").val(this.GENERIC_NAME)},setNameAwayFromGeneric:function(){var e=this.$("input#form_element_name");e.val()===this.GENERIC_NAME&&e.val("")},setLabelToGeneric:function(){this.$("input#form_element_label").val(this.GENERIC_LABEL)},setLabelAwayFromGeneric:function(){var e=this.$("input#form_element_label");e.val()===this.GENERIC_LABEL&&e.val("")},resetRequired:function(){this.$("input#form_element_required").prop("checked",!1)},resetDefaultValue:function(){this.$("input#form_element_default_value").val("")},resetChoices:function(){this.ensureCopyableChoiceField(),this.$(".form-element__choice-fields").html(""),this.$(".form-element__many-choices-field textarea").val(""),this.$(".form-element__choice-fields").append(this.$copyableChoiceField.clone())},ensureCopyableChoiceField:function(){void 0===this.$copyableChoiceField&&(this.$copyableChoiceField=this.$(".form-element__choice-field").first().clone(),this.$copyableChoiceField.find("input").val(""))},addChoice:function(){this.ensureCopyableChoiceField(),this.$(".form-element__choice-fields").append(this.$copyableChoiceField.clone())},removeChoice:function(e){var t=this.$(e.target).parents(".form-element__choice-field");this.$(".form-element__choice-fields").children().length>1?t.remove():t.find("input").val("")}});t.a=n},594:function(e,t){$(function(){var e=function(){var e=function(e){return function(t,i){var a=$(i);plugin_id=a.data("plugin-id"),url=["/plugins/forms/",e,"/",plugin_id].join(""),$.get(url,function(e){a.find(".plugin-form-preview .content").html(e)})}};$(".plugin.petition").each(e("petition")),$(".plugin.fundraiser").each(e("fundraiser")),$(".plugin.survey").each(e("survey"))};$(".plugin-form-preview .content").length>0&&($.subscribe("plugin:form:preview:update",e),$.subscribe("page:saved",e)),$(".plugin.petition, .plugin.fundraiser, .plugin.survey").on("ajax:success",function(){$.publish("plugin:form:preview:update")}),$(".plugin.petition, .plugin.fundraiser, .plugin.survey").on("ajax:error",function(e,t,i){console.log(t,i)})});var i=function(){$('[data-toggle="collapse"]').on("click",function(e){$(this).toggleClass("open")})};$.subscribe("plugin:form:loaded",i)},595:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(327),r=Backbone.View.extend({events:{"click .radio-group__option":"updateSelected","change .layout-type-checkbox":"showRelevantLayouts"},updateSelected:function(e){var t=n()(e.target);t.hasClass("radio-group__option")||(t=t.parents(".radio-group__option"));var i=t.find(".layout-settings__title").text();t.parents(".layout-settings").find(".layout-settings__current").text(i),t.parents(".layout-settings").find(".radio-group__option").removeClass("active"),t.addClass("active"),this.updatePlan(t)},updatePlan:function(e){"page[follow_up_liquid_layout_id]"===e.find("#"+e.attr("for")).attr("name")&&this.$("#page_follow_up_plan_with_liquid").prop("checked",!0)},showRelevantLayouts:function(e){var t=n()(e.target),i=t.closest(".form-group").find(".radio-group__option");if(t.is(":checked"))i.removeClass("hidden");else{var a=this.getLayoutClass(t.attr("id"));i.not(a).addClass("hidden")}},getLayoutClass:function(e){return"primary"===e?".primary-layout":"follow-up"===e?".post-action-layout":void 0}});n.a.subscribe("layout:edit pages:new",function(){i.i(s.a)(".layout-settings",r)})},596:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=Backbone.Model.extend({url:"/action_kit/check_slug",defaults:{valid:null,slug:""}}),r=Backbone.View.extend({el:"#new_page",events:{"keyup #page_title":"generateSlug","change #page_title":"generateSlug","keyup #page_slug":"resetFeedback","click #check_slug_available":"checkSlugAvailable",submit:"submit"},initialize:function(){this.slugChecker=new s,this.slugChecker.on("change:valid",_.bind(this.updateViewWithValid,this)),this.cacheDomElements(),this.checking=!1},cacheDomElements:function(){this.$title=this.$("#page_title"),this.$slug=this.$("#page_slug"),this.$feedback=this.$(".form-group.slug"),this.$checkButton=this.$("#check_slug_available"),this.$submit=this.$(".submit-new-page")},updateViewWithValid:function(){var e=this.slugChecker.get("valid");this.$submit.removeClass("disabled"),this.$(".loading").hide(),this.$(".form-group.slug").removeClass("has-error has-success has-feedback"),this.$(".form-group.slug .glyphicon").hide(),e?(this.$(".form-group.slug").addClass("has-success has-feedback"),this.$(".form-group.slug .glyphicon-ok").show()):(this.$(".slug-field").show(),this.$(".form-group.slug").addClass("has-error has-feedback"),this.$(".form-group.slug .glyphicon-remove").show())},generateSlug:function(){var e=getSlug(this.$title.val());this.resetFeedback(),this.$slug.val(e)},checkSlugAvailable:function(e,t){var i=this,a=void 0;e.preventDefault(),this.updateSlug(),a=this.$slug.val(),this.checking=!0,this.$submit.addClass("disabled"),this.$(".loading").show(),this.slugChecker.set("slug",a),this.slugChecker.save().done(function(){i.checking=!1,i.$checkButton.text("Check if name is available").removeClass("disabled"),t&&t.call(i)})},updateSlug:function(){var e=getSlug(this.$slug.val());this.resetFeedback(),this.$slug.val(e)},resetFeedback:function(){this.$feedback.removeClass("has-error has-success has-feedback")},submit:function(e){var t=this;e.preventDefault(),this.$checkButton.text("Checking...").addClass("disabled"),this.slugChecker.get("valid")?(this.$el.unbind(),this.$el.submit()):this.checkSlugAvailable(e,function(){t.slugChecker.get("valid")&&(t.$el.unbind(),t.$el.submit())})}}),o=function(){new r};n.a.subscribe("pages:new",o)},597:function(e,t,i){"use strict";var a=i(147),n=i(26),s=i.n(n),r=Backbone.Model.extend({urlRoot:"/api/pages",initialize:function(){this.lastSaved=null},save:function(e,t){s.a.isEqual(e,this.lastSaved)?"function"==typeof t.unchanged&&t.unchanged():(this.lastSaved=e,Backbone.Model.prototype.save.call(this,e,s.a.extend({patch:!0},t)))},setLastSaved:function(e){this.lastSaved=e}}),o=Backbone.View.extend({el:".page-edit-bar",events:{"click .page-edit-bar__save-button":"save","click .page-edit-bar__error-message":"findError","change .page-edit-bar__toggle-autosave .onoffswitch__checkbox":"toggleAutosave"},initialize:function(){this.outstandingSaveRequest=!1,this.addStepsToSidebar(),this.model=new r,this.setupAutosave(),this.$saveBtn=this.$(".page-edit-bar__save-button"),$("body").scrollspy({target:".scrollspy",offset:150}),this.policeHeights()},addStepsToSidebar:function(){var e=this,t=$("ul.page-edit-bar__step-list li");$(".page-edit-step").each(function(t,i){e.addStepToSidebar($(i))}),t.remove(),this.$("ul.page-edit-bar__step-list").append(t)},addStepToSidebar:function(e){var t=this.$("ul.page-edit-bar__step-list"),i=e.find(".page-edit-step__title")[0].childNodes[0].nodeValue.trim(),a=e.attr("id"),n=e.data("icon")||"cubes",s=e.data("link-to")?e.data("link-to"):"#"+a,r=e.data("link-to")?"_blank":"_self",o='<li><a href="'+s+'" target="'+r+'"><i class="fa fa-'+n+'"></i>'+i+"</a></li>";t.append(o)},readData:function(){var e=this,t={};return $("form.one-form").each(function(i,a){var n=$(a),s=n.data("type")||"base";t.hasOwnProperty(s)||(t[s]={}),$.extend(t[s],e.serializeForm(n))}),t.id=t.page["page[id]"],t},serializeForm:function(e){var t={};return s.a.each(e.serializeArray(),function(e){if(e.name.endsWith("[]")){var i=e.name.slice(0,-2);t.hasOwnProperty(i)||(t[i]=[]),t[i].push(e.value)}else t[e.name]=e.value}),t},save:function(){$.publish("wysiwyg:submit"),this.outstandingSaveRequest||(this.disableSubmit(),this.model.save(this.readData(),{success:this.saved.bind(this),error:this.saveFailed.bind(this),unchanged:this.enableSubmit.bind(this)}))},saved:function(e,t){t.refresh&&location.reload(),this.enableSubmit(),$.publish("page:saved",t),$(".page-edit-bar__save-box").removeClass("page-edit-bar__save-box--has-error"),$(".page-edit-bar__error-message").text(""),$(".page-edit-bar__last-saved").text(I18n.t("pages.edit.last_saved_at",{time:this.currentTime()})),this.policeHeights()},currentTime:function(){var e=new Date,t=("0"+e.getMinutes()).slice(-2),i=("0"+e.getSeconds()).slice(-2);return e.getHours()+":"+t+":"+i},saveFailed:function(e,t){console.error("Save failed with",e,t),this.enableSubmit(),$(".page-edit-bar__save-box").addClass("page-edit-bar__save-box--has-error"),422==t.status?(a.a.show(e,t),$(".page-edit-bar__error-message").text(I18n.t("pages.edit.user_error")),$.publish("page:errors")):$(".page-edit-bar__error-message").text(I18n.t("pages.edit.unknown_error")),this.policeHeights()},findError:function(){this.$(".page-edit-bar__save-box").hasClass("page-edit-bar__save-box--has-error")&&$(".has-error").length>0&&$("html, body").animate({scrollTop:$(".has-error").first().offset().top},500)},toggleAutosave:function(e){var t=this;this.autosave=!this.autosave,this.$(".page-edit-bar__toggle-autosave").find(".toggle-button").toggleClass("btn-primary"),this.autosave?this.$(".page-edit-bar__btn-holder").addClass("page-edit-bar__btn-holder--hidden"):this.$(".page-edit-bar__btn-holder").removeClass("page-edit-bar__btn-holder--hidden"),window.setTimeout(function(){t.policeHeights()},200)},disableSubmit:function(){this.outstandingSaveRequest=!0,this.$saveBtn.text(I18n.t("pages.edit.saving")),this.$saveBtn.addClass("disabled")},enableSubmit:function(){this.outstandingSaveRequest=!1,this.$saveBtn.text(I18n.t("pages.edit.save_work")),this.$saveBtn.removeClass("disabled")},setupAutosave:function(){var e=this,t=1==this.$(".page-edit-bar__toggle-autosave").data("autosave");this.autosave=!0,this.model.setLastSaved(this.readData()),t!=this.autosave&&this.toggleAutosave(),window.setInterval(function(){e.autosave?e.save():e.showUnsavedAlert()},5e3)},showUnsavedAlert:function(){$.publish("wysiwyg:submit");var e=$(".page-edit-bar__last-saved"),t=e.find(".page-edit-bar__unsaved-notice").length<1;s.a.isEqual(this.model.lastSaved,this.readData())?e.find(".page-edit-bar__unsaved-notice").remove():t&&e.append('<div class="page-edit-bar__unsaved-notice">'+I18n.t("pages.edit.unsaved_changes")+"</div>")},policeHeights:function(){if(!($(window).width()<=600)){var e=$(window).height()-this.$(".page-edit-bar__logo").height()-this.$(".page-edit-bar__save-box").height()-this.$(".page-edit-bar__btn-holder").outerHeight();this.$(".page-edit-bar__step-list").css("height",e+"px")}}});t.a=o},598:function(e,t,i){"use strict";var a=i(327);$(function(){var e=Backbone.View.extend({events:{"ajax:before":"toggleState","ajax:success":"handleSuccess","ajax:error":"handleError","change .onoffswitch__checkbox":"handleClick"},initialize:function(){this.$stateInput=this.$(".activation-toggle-field"),this.$checkbox=this.$(".onoffswitch__checkbox"),this.state=this.$stateInput.val()},handleClick:function(e){if("published"==this.state&&this.$stateInput.data("confirm-turning-off")&&!window.confirm(this.$stateInput.data("confirm-turning-off")))return this.toggleButton(),!1;this.$el.submit()},toggleButton:function(){this.$checkbox.prop("checked",!this.$checkbox.prop("checked"))},handleSuccess:function(e,t){},handleError:function(e,t,i){console.error("error",t,i),this.toggleButton(),this.toggleState()},toggleState:function(e){$(e.target).find("input.onoffswitch__checkbox").hasClass("use-publish-states")?this.state="published"===this.state?"unpublished":"published":this.state="true"===this.state?"false":"true",this.$stateInput.val(this.state)}});$.subscribe("activation:toggle",function(){i.i(a.a)("form.activation-toggle",e)})})},599:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=function(){n()(".page-filter__reset").click(function(){n()("select.selectize-container").map(function(e,t){t.selectize.clear()}),n()(this).closest("form").find(".form-control").map(function(e,t){n()(t).val("")})}),n()("#pages-table").DataTable({aaSorting:[]})};n.a.subscribe("search:load",s)},600:function(e,t){$(function(){$(".selectize-container").selectize({plugins:["remove_button"],closeAfterSelect:!0});var e;$(".selectize-container--clear-on-open").selectize({onDropdownOpen:function(){e=this.getValue(),this.clear()},onDropdownClose:function(){this.items.length<1&&this.setValue(e)},closeAfterSelect:!0})})},601:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(26),r=i.n(s),o=i(327),l=i(149),c=i(725),u=i.n(c),d=Backbone.View.extend({events:{"ajax:success form.shares-editor__delete-variant":"deleteVariant","click .shares-editor__toggle-edit":"toggleEditor","click .shares-editor__new-type-toggle .btn":"switchVariantForm","click .shares-editor__view-toggle .btn":"switchView","ajax:success form.shares-editor__new-form":"clearFormAndConformView"},globalEvents:{"page:saved":"updateSummaryRows","page:errors":"openEditorForErrors","image:success":"addImageSelectors","image:destroyed":"pruneImageSelectors"},initialize:function(){this.view="summary",l.a.bindEvents(this)},deleteVariant:function(e){var t=n()(e.target),i=t.parents(".shares-editor__summary-row"),a=i.next(".shares-editor__stats-row"),s=a.next(".shares-editor__edit-row");i.remove(),a.remove(),s.remove()},editRow:function(e){return e.hasClass("shares-editor__stats-row")||(e=e.next(".shares-editor__stats-row")),e.next(".shares-editor__edit-row")},toggleEditor:function(e){var t=this.$(e.target);t=t.is("tr")?t:t.parents("tr");var i=t.find(".shares-editor__toggle-edit");this.editRow(t).toggleClass("hidden-closed"),i.text("Edit"==i.text()?"Done":"Edit")},openEditor:function(e){e.prev(".shares-editor__summary-row").find(".shares-editor__toggle-edit").text("Done"),e.removeClass("hidden-closed")},switchVariantForm:function(e){var t=this.$(e.target),i=t.data("state");i&&(this.$(".shares-editor__new-type-toggle .btn").removeClass("btn-primary"),t.addClass("btn-primary"),this.$(".shares-editor__new-form").addClass("hidden-closed"),this.$('.shares-editor__new-form[data-share="'+i+'"]').removeClass("hidden-closed"))},switchView:function(e){var t=this.$(e.target),i=t.data("state");i&&this.setView(i)},setView:function(e){this.view=e,this.$(".shares-editor__view-toggle .btn").removeClass("btn-primary"),this.$('[data-state="'+e+'"]').addClass("btn-primary"),"summary"===e?(this.$(".shares-editor__summary-row").removeClass("hidden-closed"),this.$(".shares-editor__stats-row").addClass("hidden-closed"),this.$(".shares-editor__stats-heading").addClass("hidden-closed")):(this.$(".shares-editor__summary-row").addClass("hidden-closed"),this.$(".shares-editor__stats-row").removeClass("hidden-closed"),this.$(".shares-editor__stats-heading").removeClass("hidden-closed"))},clearFormAndConformView:function(e){n()(e.target).find('input[type="text"], textarea').val(""),this.setView(this.view)},openEditorForErrors:function(){this.openEditor(this.$(".has-error").parents(".shares-editor__edit-row"))},updateSummaryRows:function(e,t){var i=this;n.a.get("/api/pages/"+t.id+"/share-rows",function(e){r.a.each(e,function(e){var t=n()(e.html),a=n()("#"+t.prop("id"));a.hasClass("hidden-closed")&&t.addClass("hidden-closed"),t=a.replaceWith(t),t=n()("#"+t.prop("id")),i.editRow(t).hasClass("hidden-closed")||t.find(".shares-editor__toggle-edit").text("Done")})})},addImageSelectors:function(e,t,i,a){var n="<option value='"+i+"'>"+t.name+"</option>";this.$(".shares-editor__image-selector").append(n)},pruneImageSelectors:function(e,t){this.$('option[value="'+t+'"]').remove()}});n.a.subscribe("shares:edit",function(){i.i(o.a)(".shares-editor",d)}),n()(function(){new u.a(".share-copy-url"),n()(".shares-editor__existing").on("click",".share-copy-url",function(e){e.preventDefault()})})},602:function(e,t,i){"use strict";var a=i(24),n=i.n(a),s=i(327),r=Backbone.View.extend({events:{"click .sidebar__header-link":"toggleGroup"},toggleGroup:function(e){n()(e.target).parents(".sidebar__group").toggleClass("sidebar__group--closed sidebar__group--open")}});n.a.subscribe("sidebar:nesting",function(){i.i(s.a)(".sidebar",r)})},603:function(e,t,i){"use strict";var a=i(149),n=Backbone.View.extend({el:".survey",events:{"sortupdate .survey__forms":"handleSort"},globalEvents:{"survey:form_added":"makeSortable"},initialize:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.makeSortable(),this.id=this.$el.data("plugin-id"),a.a.bindEvents(this)},makeSortable:function(){this.$(".survey__forms").sortable()},handleSort:function(e,t){var i=this;if($(e.target).hasClass("survey__forms")){var a=t.item.parent().children().map(function(e,t){return i.$(t).data("id")}).get();this.saveFormOrder(a)}},saveFormOrder:function(e){$.ajax("/plugins/surveys/"+this.id+"/sort",{method:"PUT",data:{form_ids:e.join(",")}}).done(function(){$.publish("plugin:form:preview:update")})}});t.a=n},604:function(e,t,i){"use strict";var a=i(24),n=i.n(a);n()(function(){n()(".syntax-highlighting").each(function(e,t){var i=n()(t).data("highlight-mode")||"htmlmixed",a=CodeMirror.fromTextArea(t,{mode:i,theme:"3024-night"});n.a.subscribe("wysiwyg:submit",a.save)})})},605:function(e,t,i){"use strict";var a=i(24),n=i.n(a);n.a.subscribe("pages:new pages:edit form:edit pages:analytics",function(){n()('[data-toggle="tooltip"]').tooltip()})},668:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(i(380),i(147),i(604),i(592),i(600)),n=(i.n(a),i(599),i(591),i(594)),s=(i.n(n),i(588),i(596),i(598),i(602),i(605),i(590),i(601),i(587),i(595),i(597)),r=i(589),o=i(603),l=i(593);Object.assign(window,{PageEditBar:s.a,Analytics:r.a,SurveyEditor:o.a,FormElementCreator:l.a})},724:function(e,t,i){var a,n,s;!function(r,o){n=[e,i(800)],a=o,void 0!==(s="function"==typeof a?a.apply(t,n):a)&&(e.exports=s)}(0,function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(e){return e&&e.__esModule?e:{default:e}}(t),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=function(){function e(t){i(this,e),this.resolveOptions(t),this.initSelection()}return s(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var i=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=i+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,a.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,a.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":n(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=r})},725:function(e,t,i){var a,n,s;!function(r,o){n=[e,i(724),i(806),i(766)],a=o,void 0!==(s="function"==typeof a?a.apply(t,n):a)&&(e.exports=s)}(0,function(e,t,i,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){var i="data-clipboard-"+e;if(t.hasAttribute(i))return t.getAttribute(i)}var c=n(t),u=n(i),d=n(a),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),p=function(e){function t(e,i){s(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.resolveOptions(i),a.listenClick(e),a}return o(t,e),f(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===h(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,d.default)(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new c.default({action:this.action(t),target:this.target(t),text:this.text(t),container:this.container,trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return l("action",e)}},{key:"defaultTarget",value:function(e){var t=l("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return l("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,i=!!document.queryCommandSupported;return t.forEach(function(e){i=i&&!!document.queryCommandSupported(e)}),i}}]),t}(u.default);e.exports=p})},732:function(e,t){function i(e,t){for(;e&&e.nodeType!==a;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}var a=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}e.exports=i},733:function(e,t,i){function a(e,t,i,a,s){var r=n.apply(this,arguments);return e.addEventListener(i,r,s),{destroy:function(){e.removeEventListener(i,r,s)}}}function n(e,t,i,a){return function(i){i.delegateTarget=s(i.target,t),i.delegateTarget&&a.call(e,i)}}var s=i(732);e.exports=a},765:function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var i=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===i||"[object HTMLCollection]"===i)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},766:function(e,t,i){function a(e,t,i){if(!e&&!t&&!i)throw new Error("Missing required arguments");if(!o.string(t))throw new TypeError("Second argument must be a String");if(!o.fn(i))throw new TypeError("Third argument must be a Function");if(o.node(e))return n(e,t,i);if(o.nodeList(e))return s(e,t,i);if(o.string(e))return r(e,t,i);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function n(e,t,i){return e.addEventListener(t,i),{destroy:function(){e.removeEventListener(t,i)}}}function s(e,t,i){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,i)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,i)})}}}function r(e,t,i){return l(document.body,e,t,i)}var o=i(765),l=i(733);e.exports=a},800:function(e,t){function i(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var i=e.hasAttribute("readonly");i||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),i||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var a=window.getSelection(),n=document.createRange();n.selectNodeContents(e),a.removeAllRanges(),a.addRange(n),t=a.toString()}return t}e.exports=i},806:function(e,t){function i(){}i.prototype={on:function(e,t,i){var a=this.e||(this.e={});return(a[e]||(a[e]=[])).push({fn:t,ctx:i}),this},once:function(e,t,i){function a(){n.off(e,a),t.apply(i,arguments)}var n=this;return a._=t,this.on(e,a,i)},emit:function(e){var t=[].slice.call(arguments,1),i=((this.e||(this.e={}))[e]||[]).slice(),a=0,n=i.length;for(a;a<n;a++)i[a].fn.apply(i[a].ctx,t);return this},off:function(e,t){var i=this.e||(this.e={}),a=i[e],n=[];if(a&&t)for(var s=0,r=a.length;s<r;s++)a[s].fn!==t&&a[s].fn._!==t&&n.push(a[s]);return n.length?i[e]=n:delete i[e],this}},e.exports=i},94:function(e,t){e.exports=window.Backbone}});
//# sourceMappingURL=campaigner_facing-0883100c07190a4df197.js.map